load_module modules/ngx_http_access_module.so;
events {}
user root;

http{
	include /etc/nginx/mime.types;

	server_tokens off;
	more_clear_headers Server;
	
	log_format main '$remote_addr ? $remote_user [$time_local]  $status $request $body_bytes_sent $http_referer $http_user_agent $http_x_forwarded_for';
    	
    	server{
        	listen 1005;
	        server_name 127.0.0.1;
	        root /home/curso/06/valid_referers/site/;
	        index index.php;

		add_header X-Frame-Options "SAMEORIGIN";
				
		location "~\.php$" {
			include /etc/nginx/fastcgi.conf;
			fastcgi_pass unix:/run/php/php7.4-fpm.sock;
		}
		
		location "~\.png$" {
			valid_referers none blocked server_names meusite.com.br;			
			if ($invalid_referer) { return 403; }		
		}

	access_log /home/curso/06/headers/logs/access1005.log main;	
	error_log /home/curso/06/headers/logs/error1005.log;
    	}

	server{
		listen 1006;
	        server_name 127.0.0.1;

		root /home/curso/06/valid_referers/galeria/;
		index index.html;
	
	access_log /home/curso/06/headers/logs/access1006.log main;	
	error_log /home/curso/06/headers/logs/error1006.log;
	
	}	
}
#location ~* \.(?:ico|css|js|gif|jpe?g|png)$ {